#!/usr/bin/env ruby

require 'optparse'
require_relative '../client'

pid  = nil
num  = 3

OptionParser.new do |args|
  args.on('-nNUM') { |n| num = n.to_i }
  args.on('-pPID') { |p| pid = p.to_i }
end.parse!

if pid.nil?
  threads = (1..num).map do |pid|
    Thread.new do
      client = Client.new(pid: pid, network_size: num)
      client.run!
    end
  end

  threads.each do |thread|
    thread.join
  end
else
  client = Client.new(pid: pid, network_size: num)
  client.run!
end
